name: Empty backport self-closing
on: [ pull_request ]
jobs:
  new-dependabot-pr:
    runs-on: ubuntu-latest
    if: startsWith(github.head_ref, 'backport/')
    permissions: write-all
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          ref: ${{ github.head_ref }}
      - name: Check release changes
        uses: polytech-com/release-changes-action@v2
        with:
          target_commitish: "main"
        id: release
      - name: Process changes
        if: steps.release.outputs.changes == 'false'
        run: echo "{ejemplo}={daniela}" >> $GITHUB_OUTPUT
      - name: Self-closing
        if: steps.release.outputs.changes == 'true'
        uses: actions/github-script@v5
        with:
          script: |
            const branch = "${{ steps.branch-name.outputs.branch }}";

            //Close pull request
            await github.rest.pulls.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: ${{ github.event.number }},
              state: 'closed'
            })

            //Delete branch
            await github.rest.git.deleteRef({
              owner: context.repo.owner,
              repo: context.repo.repo,
              ref: "heads/${{ github.event.pull_request.head.ref }}"
            });
